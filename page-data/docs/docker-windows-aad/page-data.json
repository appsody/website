{"componentChunkName":"component---src-templates-doc-template-js","path":"/docs/docker-windows-aad/","webpackCompilationHash":"183e74cfda8a850e9a16","result":{"data":{"markdownRemark":{"html":"<h1 id=\"appsody-and-docker-desktop-on-windows-10\"><a href=\"#appsody-and-docker-desktop-on-windows-10\" aria-label=\"appsody and docker desktop on windows 10 permalink\" class=\"header-link-icon\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Appsody and Docker Desktop on Windows 10</h1>\n<p>Docker Desktop on Windows requires access to the computer's filesystems in order to mount host volumes contained in those filesystems. That access is explained in detail in the \"Shared Drives\" section of the <a href=\"https://docs.docker.com/docker-for-windows/\">\"Get started with Docker for Windows\"</a> page.</p>\n<p>Appsody relies on mounted hosted volumes to expedite the startup of applications under development, so that it is imperative that Docker Desktop be configured to access the shared drive containing the user's home directory. Once Docker has that access, the next requirement is for that user to have the \"Full Control\" permission to directories mounted to containers.</p>\n<p>In most cases, it is sufficient to configure Docker with the same user as the user developing applications with Appsody.</p>\n<p>However, for users of Windows 10 Enterprise secured with Azure Active Directory (AAD), the AAD user does not reside in the local host and may not be accepted in the \"Shared Drives\" tab of the Docker Desktop \"Settings\" page, specially if the organization has configured AAD to use authentication mechanisms that do not include user passwords, such as PIN codes.</p>\n<h2 id=\"workaround-for-windows-10-enterprise-secured-with-azure-active-directory\"><a href=\"#workaround-for-windows-10-enterprise-secured-with-azure-active-directory\" aria-label=\"workaround for windows 10 enterprise secured with azure active directory permalink\" class=\"header-link-icon\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Workaround for Windows 10 Enterprise secured with Azure Active Directory</h2>\n<p>If Docker Desktop does not accept your AAD user and password in the \"Shared Drives\" tab of the Docker \"Settings\" panel, or you just do not have the password for your user, the only known workaround at this time is to use a separate, local, Windows account to handle the drive sharing and file permissions.</p>\n<p>Assuming the creation of a new user does not violate your organization policies, the workaround is comprised of the following steps:</p>\n<ol>\n<li>\n<p><a href=\"https://support.microsoft.com/en-us/help/4026923/windows-10-create-a-local-user-or-administrator-account\">Create a new local user account</a> on Windows and use that account and respective password in the \"Shared Drives\" tab of the Docker Desktop's \"Settings\" panel.</p>\n<p>   Most systems will have only a single shared drive, labeled \"C\". If your \"Shared Drives\" list shows additional drive letters, make sure you select the label matching the drive letter for the AAD user's home directory.</p>\n</li>\n<li>\n<p>Grant the new user from step 1 the \"Full Control\" permission to the folders to be mounted by Appsody into a container. You could use the \"Security\" tab for each folder properties in the File Explorer application, but the quickest and simplest mechanism is to open a \"Command Prompt\" and issue the following commands to achieve the same results:</p>\n<pre><code>REM This has to be the same user applied to the Shared Drive in Docker Desktop\nset DOCKER_SHARED_DRIVE_USER=Developer\n\nREM if using the java-microprofile collection and until issue \nREM https://github.com/appsody/stacks/issues/363 is resolved:\nmkdir %USERPROFILE%\\.m2\\repository\nicacls \"%USERPROFILE%\\.m2\" /grant %DOCKER_SHARED_DRIVE_USER%:(OI)(CI)F\n\nmkdir %USERPROFILE%\\.appsody\nicacls \"%USERPROFILE%\\.appsody\" /grant %DOCKER_SHARED_DRIVE_USER%:(OI)(CI)F\n\nmkdir %USERPROFILE%\\directory-for-appsody-project\nicacls \"%USERPROFILE%\\directory-for-appsody-project\" /grant %DOCKER_SHARED_DRIVE_USER%:(OI)(CI)F\n</code></pre>\n<p>Note that the user in the <code>DOCKER_SHARED_DRIVE_USER</code> environment variable must match the user specified in the Docker Desktop \"Shared Drives\" tab in the first step. </p>\n<p>Repeat the <code>mkdir</code> and <code>icacls</code> commands for any other directory where you are about to create a new Appsody project. If you plan on creating multiple projects, you can also target a parent directory for those future project directories, so that you do not have to repeat the commands for each new Appsody project directory.</p>\n<p>Since the parameters for <code>icacls</code> specify a recursive authorization, granting the permission directly to the <code>%USERPROFILE%</code> directory could be faster and simpler, but the instructions in this page were written to minimize impact to the system.</p>\n</li>\n<li>\n<p>Validating the correct permissions</p>\n<p>The commands below will run a docker container that creates (and subsequently removes) a directory in each of the directories used by Appsody. The commands will indicate the successful outcome of the validation if the shared drive access and the filesystem permissions are set correctly, </p>\n<pre><code>docker run --rm -it -v \"%USERPROFILE%\\.appsody\":/data alpine  /bin/sh  -c \"mkdir /data/test-write-permission &#x26;&#x26; echo Success; rmdir /data/test-write-permission\"\n\ndocker run --rm -it -v \"%USERPROFILE%\\directory-for-appsody-project\":/data alpine  /bin/sh  -c \"mkdir /data/test-write-permission &#x26;&#x26; echo Success; rmdir /data/test-write-permission\"\n\nREM if you also granted permissions to the .m2 folder:\ndocker run --rm -it -v \"%USERPROFILE%\\.m2\\repository\":/data alpine  /bin/sh  -c \"mkdir /data/test-write-permission &#x26;&#x26; echo Success; rmdir /data/test-write-permission\"\n</code></pre>\n</li>\n</ol>\n<h2 id=\"removing-the-workaround\"><a href=\"#removing-the-workaround\" aria-label=\"removing the workaround permalink\" class=\"header-link-icon\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Removing the workaround</h2>\n<p>If you want to revert the Windows filesystem permissions later, open another \"Command Prompt\" and execute a <code>icacls ... /remove</code> command on all affected directories. The operation is recursive and will remove the permissions from sub-directories of those directories as well.</p>\n<p>As an example, for the specific instructions in this page, you would execute the following commands:</p>\n<pre><code>set DOCKER_SHARED_DRIVE_USER=Developer\n\nicacls \"%USERPROFILE%\\.m2\" /remove %DOCKER_SHARED_DRIVE_USER%\nicacls \"%USERPROFILE%\\.appsody\" /remove %DOCKER_SHARED_DRIVE_USER%\nicacls \"%USERPROFILE%\\directory-for-appsody-project\" /remove %DOCKER_SHARED_DRIVE_USER%\n</code></pre>\n<p>You may decide whether or not to remove the directories after removing the permissions.</p>"}},"pageContext":{"isCreatedByStatefulCreatePages":false}}}