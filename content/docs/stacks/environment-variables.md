---
title: Appsody Environment Variables
---

# Appsody Environment Variables
Stack creators configure Appsody environment variables to specify the behaviour they expect from the stack throughout the application development lifecycle. The stack creators define these variables for the stack image in the `Dockerfile-stack`. The Appsody CLI and Appsody controller inspect these environment variables and then drive the expected behaviour for the developer.

If a stack image is built upon another stack's image, it inherits all the Appsody variables from the base stack. It can override the variables it wants to change. This allows users to create stacks with slightly different behaviour while still getting updates from the base stack.

> Note that when using the environment variables, you should declare them using the ENV instruction, following from typical [Dockerfile syntax](https://docs.docker.com/engine/reference/builder/#env). 

If the environment variable defines a command that is too long or complex, it may be better to encapsulate your command into a script.

``* denotes a variable that stack creators must define and are mandatory.

** denotes a variable that stack creators are expected to define. It is not mandatory, but a warning is generated when your stack is linted if you do not.

The following are the currently supported Appsody environment variables:

## Common Environment Variables
The environment variables that are used to set up the development workspace for the stack, as such they apply across all of the commands used for Appsody local development (run, test and debug).

| Environment Variable        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Example                                                                                                                                                                                                                            | Default                             |
|-----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
| `APPSODY_PROJECT_DIR`**     | Defines the local directory to extract the full application (the stack and your Appsody project) into, from the container when running [appsody extract](https://appsody.dev/docs/using-appsody/cli-commands/#appsody-extract), [appsody build](https://appsody.dev/docs/using-appsody/cli-commands/#appsody-build) or [appsody deploy](https://appsody.dev/docs/using-appsody/cli-commands/#appsody-deploy).                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | ` APPSODY_PROJECT_DIR=/my-project` <br><br> Your application is extracted into the `/my-project` directory on your local machine.                                                                                          | /project                            |
| `APPSODY_MOUNTS`*           | List of directories (separated by ;) to be mounted in the Appsody container. Each mount is specified with `source path:destination path` syntax, where the first field is the path to the directory on the host machine (source), and the second field is the path where the directory is mounted in the container (destination).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | ` APPSODY_MOUNTS=.:/project/user-app` <br><br> Everything in the current directory is mounted to the `/project/user-app` directory in the container.                                                                          | N/A                                 |
| `APPSODY_DEPS`**            | Used to cache the combined dependencies of the stack components and the user application by mounting it to a persistent Docker volume. This variable can contain only one directory.                                                                                                                                                                                                                                                                                                                                                                                                  | ` APPSODY_DEPS=/project/deps` <br><br> The `/project/deps` directory is mounted into a Docker volume.                                                                                                                      | N/A                                 |
| `APPSODY_USER_RUN_AS_LOCAL` | Sets the user identity within the container to match the host user’s UID. If a stack mounts a host directory, it ensures that files written to the host directory are using the host user’s UID, to avoid container-created files being owned by `root`.                                                                                                                                                                                                                                                                                                                                                                                                                                   | ` APPSODY_USER_RUN_AS_LOCAL=true` <br><br> The container's user identity is set to the host user's UID.                                                                                                                    | false                               |
| `APPSODY_PREP`              | This command is executed before the local development Appsody commands are run. This command should only be used to perform prerequisite checks or preparation steps prior to starting the app server. <br><br>If this command fails, the Appsody container terminates. It is not recommended to perform code compilation tasks in `APPSODY_PREP` because compilation errors can typically be fixed and recovered while the container is running with the local development Appsody commands. Unlike those commands, `APPSODY_PREP` is only run once, on starting the container. <br><br> Note: `APPSODY_PREP` has replaced `APPSODY_INSTALL`, which is now deprecated. | ` APPSODY_PREP="npm install --prefix user-app"` <br><br> Runs `npm install --prefix user-app` prior to running all local development Appsody commands.                                                                        | N/A                                 |
| `APPSODY_WATCH_DIR`         | List of directories (separated by ;) that the controller monitors for file changes. The controller will recursively monitor the subdirectories in these directories. The [appsody stack lint](https://appsody.dev/docs/using-appsody/cli-commands/#appsody-stack-lint) command will error if you do not define at least one of the Appsody local development `ON_CHANGE` variables, when using the controller for file watching.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      | ` APPSODY_WATCH_DIR=/project/user-app/src;/project/user-app/tests` <br><br> The controller watches for changes in the `/project/user-app/src` and `/project/user-app/tests` directories.                                     | `APPSODY_MOUNTS`                    |
| `APPSODY_WATCH_INTERVAL`    | Frequency (in seconds) at which the controller checks for any file changes.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | ` APPSODY_WATCH_INTERVAL=3` <br><br> Controller performs the watch check every 3 seconds.                                                                                                                               | 2 seconds                           |
| `APPSODY_WATCH_IGNORE_DIR`  | List of directories (separated by ;) that the controller does not monitor for file changes, typically used for excluding subdirectories of paths specified in `APPSODY_WATCH_DIR`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | ` APPSODY_WATCH_IGNORE_DIR=/project/user-app/node_modules;/project/user-app/package.lock` <br><br> Controller ignores changes in the `/project/user-app/node_modules` directory and the `/project/user-app/package.lock` file. | N/A                                 |
| `APPSODY_WATCH_REGEX`       | Regex expression that specifies the files that are monitored for changes. It is used to match the filename or the leaf directory, not the full path. The controller uses the Go regexp package, which does not support negative look ahead matching (e.g. ignore patterns).                                                                                                                                                                                                                                                                                                                                                 | ` APPSODY_WATCH_REGEX="^.*.js$"` <br><br> Controller watches for changes in `.js` files.                                                                                                                                 | `"(^.*.java$)|(^.*.js$)|(^.*.go$)"` |



## Run Environment Variables
The environment variables that define how to start the development container, that is, when [appsody run](https://appsody.dev/docs/using-appsody/cli-commands/#appsody-run) is run. You can set these environment variables so Appsody watches your local project directory for file changes, and updates the application to reflect code changes as you develop.

| Environment Variable     | Description                                                                                                                                                                                                                                                                                                                                                                                                                       | Example                                                                                                                                    | Default |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|---------|
| `APPSODY_RUN`*           | Defines the run command to start the server process after the `APPSODY_PREP` command completes.                                                                                                                                                                       | ` APPSODY_RUN="npm start"` <br><br> Runs `npm start` after running the `APPSODY_PREP` command.                                          | N/A     |
| `APPSODY_RUN_ON_CHANGE`  | This command runs when a change is detected on the file system by the controller. <br><br> If file watching is disabled, this value should be "". | ` APPSODY_RUN_ON_CHANGE="npm start"` <br><br> Runs `npm start` when a file being watched by the controller is changed.                  | N/A     |
| `APPSODY_RUN_KILL`       | This variable signals whether or not the controller kills the server process started by `APPSODY_RUN`, prior to starting the watch action specified by `APPSODY_RUN_ON_CHANGE`.                                                                                                                                                                                                                                  | ` APPSODY_RUN_KILL=false` <br><br> The server process started by `APPSODY_RUN` is not killed, prior to running `APPSODY_RUN_ON_CHANGE`. | true    |
    


## Test Environment Variables
The environment variables that define how to start the development container, and run the test suite for both the stack and your application in the container, that is, when [appsody test](https://appsody.dev/docs/using-appsody/cli-commands/#appsody-test) is run.

| Environment Variable      | Description                                                                                                                                                                                                                                                                                                                                                                                                                            | Example                                                                                                                                                      | Default |
|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| `APPSODY_TEST`**          | Defines the test command to run the test suite after the `APPSODY_PREP` command completes.                                                                                                                                                                               | ` APPSODY_TEST="npm test && npm test --prefix user-app"` <br><br> Runs `npm test && npm test --prefix user-app` after running the `APPSODY_PREP` command. | N/A     |
| `APPSODY_TEST_ON_CHANGE`  | This command runs when a change is detected on the file system by the controller. <br><br> If file watching is disabled, this value should be "". | ` APPSODY_TEST_ON_CHANGE=""` <br><br> File watching is disabled, so the container terminates after the test suite has been run once.                  | N/A     |
| `APPSODY_TEST_KILL`       | This variable is used to signal whether or not the controller kills the server process started by `APPSODY_TEST` prior to starting the watch action specified by `APPSODY_TEST_ON_CHANGE`.                                                                                                                                                                                                                           | ` APPSODY_TEST_KILL=false`  <br><br> The server process started by `APPSODY_TEST` is not killed, prior to running `APPSODY_TEST_ON_CHANGE`.               | true    |
   

## Debug Environment Variables
The environment variables that define how to start the development container with a debugger enabled, that is, when [appsody debug](https://appsody.dev/docs/using-appsody/cli-commands/#appsody-debug) is run. Typically, the stack provides a debug port that connects to your IDE. You can then set breakpoints and step through your code as it runs in the container.

| Environment Variable       | Description                                                                                                                                                                                                                                                                                                                                                                                                                               | Example                                                                                                                                       | Default |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|---------|
| `APPSODY_DEBUG`**          | Defines the debug command to run after the `APPSODY_PREP` command completes.                                                                                                                                                                                                        | ` APPSODY_DEBUG="npm run debug"` <br><br> Runs `npm run debug` after running the `APPSODY_PREP` command.                                   | N/A     |
| `APPSODY_DEBUG_ON_CHANGE`  | This command runs when a change is detected on the file system by the controller. <br><br> If file watching is disabled, this value should be "". | ` APPSODY_DEBUG_ON_CHANGE="npm run debug"` <br><br> Runs `npm run debug` when a file being watched by the controller is changed.           | N/A     |
| `APPSODY_DEBUG_KILL`       | This variable signals whether or not the controller kills the server process started by `APPSODY_DEBUG` prior to starting the watch action specified by `APPSODY_DEBUG_ON_CHANGE`.                                                                                                                                                                                                                                    | `APPSODY_DEBUG_KILL=false`  <br><br> The server process started by `APPSODY_DEBUG` is not killed, prior to running `APPSODY_DEBUG_ON_CHANGE`. | true    |
