---
title: Appsody Environment Variables
---

# Appsody Environment Variables
Stack creators configure Appsody environment variables to specify the behaviour they expect from the stack throughout the application development lifecycle. These variables are defined in `Dockerfile-stack` for the stack image. `Appsody CLI` and `Appsody controller` inspect these environment variables and then drive the expected behaviour for the developer.

If a stack image is built upon another stack's image, it inherits all the Appsody variables from the base stack. It can override the variables it wants to change. This allows users to create stacks with slightly different behaviour while still getting updates from the base stack.

The following are the currently supported Appsody environment variables (* denotes a recommended variable to define):

## Common Environment Variables
This is the common set of environment variables that is used for setting up the stack's development workspace.

| Environment Variable        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                | Example                                                                                                                                                                                                                            | Default                             |
|-----------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------|
| `APPSODY_WATCH_DIR`*        | This is the directories the controller watches for changes. There can be multiple directories separated by a ';'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          | `ENV APPSODY_WATCH_DIR=/project/user-app/src;/project/user-app/tests` <br><br> The controller watches for changes in the `/project/user-app/src` and `/project/user-app/tests` directories.                                     | `APPSODY_MOUNTS`                    |
| `APPSODY_WATCH_INTERVAL`    | This is the watch interval (in seconds).                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `ENV APPSODY_WATCH_INTERVAL=3` <br><br> The controller performs the watch check every 3 seconds.                                                                                                                               | 2 seconds                           |
| `APPSODY_WATCH_REGEX`*      | This is the regex expression that describes which files are watched for changes. The controller uses the go `regexp` package, which does not support negative look ahead matching (e.g. ignore patterns).  The `APPSODY_WATCH_REGEX` is used to match the filename or the leaf directory, not the full path.                                                                                                                                                                                                                                                                                                                                                                               | `ENV APPSODY_WATCH_REGEX="^.*.js$"` <br><br> The controller watches for changes in `.js` files.                                                                                                                                 | `"(^.*.java$)|(^.*.js$)|(^.*.go$)"` |
| `APPSODY_WATCH_IGNORE_DIR`  | This is the directories the controller ignores any changes in. There can be multiple directories separated by a ';'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `ENV APPSODY_WATCH_IGNORE_DIR=/project/user-app/node_modules;/project/user-app/package.lock` <br><br> The controller ignores changes in the `/project/user-app/node_modules` and `/project/user-app/package.lock` directories. | N/A                                 |
| `APPSODY_MOUNTS`*           | This is the mount directories, which can alternatively be used as watch directories if no value exists for  `APPSODY_WATCH_DIR`.              There can be multiple mount directories separated by a ';'.                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  | `ENV APPSODY_MOUNTS=.:/project/user-app` <br><br> Everything in the current directory is mounted to the `/project/user-app` directory in the container.                                                                          | N/A                                 |
| `APPSODY_DEPS`*             | This is used to cache the combined dependencies of the stack components and the user application by mounting it to a persistent Docker volume. It is not mounted into the user directory as it is not required outside the Docker environment. This variable can only have one directory.                                                                                                                                                                                                                                                                                                                                                                                                  | `ENV APPSODY_DEPS=/project/deps` <br><br> The `/project/deps` directory is mounted into a Docker volume.                                                                                                                      | N/A                                 |
| `APPSODY_PREP`              | This command is executed before the 'Local Development' Appsody commands are run. This command should only be used to perform prerequisite checks or preparation steps prior to starting the app server. <br><br>If this command fails, the Appsody container terminates. It is not recommended to perform code compilation tasks in `APPSODY_PREP` because compilation errors can typically be fixed and recovered while the container is running with the 'Local Development' Appsody commands. Unlike those commands, `APPSODY_PREP` is only run once, on starting the container. <br><br> Note: `APPSODY_INSTALL` is deprecated and has been replaced with `APPSODY_PREP` | `ENV APPSODY_PREP="npm install --prefix user-app"` <br><br> Runs `npm install --prefix user-app` prior to running all 'Local Development' Appsody commands.                                                                        | N/A                                 |
| `APPSODY_PROJECT_DIR`       | This is used as the directory when extracting the full application (the stack and your Appsody project), from the container into a local directory when running  `appsody extract`, `appsody build` or `appsody deploy`.                                                                                                                                                                                                                                                                                                                                                                                                                                                                   | `ENV APPSODY_PROJECT_DIR=/my-project` <br><br> Your application is extracted into the `/my-project` directory on your local machine.                                                                                          | /project                            |
| `APPSODY_USER_RUN_AS_LOCAL` | Sets the user identity within the container to match the host user’s UID. If a stack mounts a host directory, it ensures that files written to the host directory are using the host user’s UID, to avoid container-created files being owned by `root`.                                                                                                                                                                                                                                                                                                                                                                                                                                   | `ENV APPSODY_USER_RUN_AS_LOCAL=true` <br><br> The container's user identity is set to the host user's UID.                                                                                                                    | false                               |


## Run Environment Variables
This is the set of environment variables that starts the development container in `run` mode. You can set these environment variables so Appsody watches your local project directory for file changes, and updates the application to reflect code changes as you develop.

| Environment Variable     | Description                                                                                                                                                                                                                                                                                                                                                                                                                       | Example                                                                                                                                    | Default |
|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------|---------|
| `APPSODY_RUN`*           | This command runs the server process after the `APPSODY_PREP` command, when the mode is 'run'. If your command involves complex environment variable expansions, it may be better to encapsulate your command into a script.                                                                                                                                                                                                      | `ENV APPSODY_RUN="npm start"` <br><br> Runs `npm start` after running the `APPSODY_PREP` command.                                          | N/A     |
| `APPSODY_RUN_ON_CHANGE`* | This command runs when a change is detected on the file system by the controller, when the mode is 'run'. <br><br> If `APPSODY_RUN_KILL=false`, this action is only used if the application launched by `APPSODY_RUN` is still running. If your command involves complex environment variable expansions, it may be better to encapsulate your command into a script. If file watching is disabled, this value should be "". | `ENV APPSODY_RUN_ON_CHANGE="npm start"` <br><br> Runs `npm start` when a file being watched by the controller is changed.                  | N/A     |
| `APPSODY_RUN_KILL`*      | This variable signals that when the mode is "run", whether or not the controller kills the server process started by `APPSODY_RUN` prior to starting the watch action specified by `APPSODY_RUN_ON_CHANGE`.                                                                                                                                                                                                                                  | `ENV APPSODY_RUN_KILL=false` <br><br> The server process started by `APPSODY_RUN` is not killed, prior to running `APPSODY_RUN_ON_CHANGE`. | true    |
    


## Test Environment Variables
This is the set of environment variables that starts the development container, and runs the test suite for both the stack and your application in the container.

| Environment Variable      | Description                                                                                                                                                                                                                                                                                                                                                                                                                            | Example                                                                                                                                                      | Default |
|---------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------|---------|
| `APPSODY_TEST`*           | This command runs the test suite after the `APPSODY_PREP` command, when the mode is 'test'. If your command involves complex environment variable expansions, it may be better to encapsulate your command into a script.                                                                                                                                                                                                              | `ENV APPSODY_TEST="npm test && npm test --prefix user-app"` <br><br> Runs `npm test && npm test --prefix user-app` after running the `APPSODY_PREP` command. | N/A     |
| `APPSODY_TEST_ON_CHANGE`* | This command runs when a change is detected on the file system by the controller, when the mode is 'test'. <br><br> When `APPSODY_TEST_KILL=false`, this action is only used if the application launched by `APPSODY_TEST` is still running. If your command involves complex environment variable expansions, it may be better to encapsulate your command into a script. If file watching is disabled, this value should be "". | `ENV APPSODY_TEST_ON_CHANGE=""` <br><br> File watching is disabled, so the container terminates after the test suite has been run once.                  | N/A     |
| `APPSODY_TEST_KILL`*      | This variable is used to signal that when the mode is "test", whether or not the controller kills the server process started by `APPSODY_TEST` prior to starting the watch action specified by `APPSODY_TEST_ON_CHANGE`.                                                                                                                                                                                                                           | `ENV APPSODY_TEST_KILL=false`  <br><br> The server process started by `APPSODY_TEST` is not killed, prior to running `APPSODY_TEST_ON_CHANGE`.               | true    |
   

## Debug Environment Variables
This is the set of environment variables that starts the development container with a debugger enabled. Typically, the stack provides a debug port that connects to your IDE. You can then set breakpoints and step through your code as it runs in the container.

| Environment Variable       | Description                                                                                                                                                                                                                                                                                                                                                                                                                               | Example                                                                                                                                       | Default |
|----------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|---------|
| `APPSODY_DEBUG`*           | This command runs the server process run after the `APPSODY_PREP` command, when the mode is 'debug'. If your command involves complex environment variable expansions, it may be better to encapsulate your command into a script.                                                                                                                                                                                                        | `ENV APPSODY_DEBUG="npm run debug"` <br><br> Runs `npm run debug` after running the `APPSODY_PREP` command.                                   | N/A     |
| `APPSODY_DEBUG_ON_CHANGE`* | This command runs when a change is detected on the file system by the controller, when the mode is 'debug'. <br><br> When `APPSODY_DEBUG_KILL=false`, this action is only used if the application launched by `APPSODY_DEBUG` is still running. If your command involves complex environment variable expansions, it may be better to encapsulate your command into a script. If file watching is disabled, this value should be "". | `ENV APPSODY_DEBUG_ON_CHANGE="npm run debug"` <br><br> Runs `npm run debug` when a file being watched by the controller is changed.           | N/A     |
| `APPSODY_DEBUG_KILL`*      | This variable signals that when the mode is "debug", whether or not the controller kills the server process started by `APPSODY_DEBUG` prior to starting the watch action specified by `APPSODY_DEBUG_ON_CHANGE`.                                                                                                                                                                                                                                    | `APPSODY_DEBUG_KILL=false`  <br><br> The server process started by `APPSODY_DEBUG` is not killed, prior to running `APPSODY_DEBUG_ON_CHANGE`. | true    |
